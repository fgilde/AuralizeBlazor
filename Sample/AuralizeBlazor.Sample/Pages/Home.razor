@page "/"
@using System.Reflection
@using AuralizeBlazor.Features
@using AuralizeBlazor.Options
@using MudBlazor.Extensions.Helper

<PageTitle>Home</PageTitle>

<MudExSelect Virtualize="true" Class="mt-1 mb-1" T="VisualizerPreset" Variant="Variant.Filled" ValueChanged="@HandleChange" Value="_preset" ItemCollection="@(_presets)"></MudExSelect>

<BlazorAudioVisualizer @ref=_vis
                       Features="@(new IVisualizerFeature[]{ new ShowLogoFeature {Label = Const.AppName, Position = TextPosition.CenterCenter}, new SwitchPresetFeature() })"
                       InitialPreset="VisualizerPreset.ReflexMirror"
                       GradientChanged="@MainLayout.Instance.ColorsChanged"
                       Presets="@VisualizerPreset.All"
                       PresetApplied="OnPresetApplied"
                       Height="700px"
                       BackgroundImage="https://www.pr-bild-award.de/site-prba/assets/files/1/prba-teaser.jpg"
                       ConnectAllAudioSources="true"
                       ClickAction="VisualizerAction.TogglePlayPause"
                       ContextMenuAction="VisualizerAction.TogglePictureInPicture"
                       OverlayChildContent="false"
                       Overlay="false">
    <center>
        <audio class="audio-main mud-ex-animate-all-properties" preload="metadata" loading="lazy" controls="true" src="/sample.mp3"></audio>
    </center>
</BlazorAudioVisualizer>

<MudExpansionPanel Text="Show / Hide Code">
    <MudExCodeView RenderChildContent="false" Code="Hallo"/>
</MudExpansionPanel>


@* <MudExObjectEdit Value="@_vis"></MudExObjectEdit> *@

@code {

    BlazorAudioVisualizer _vis;
    private VisualizerPreset? _preset;
    private readonly VisualizerPreset[] _presets = VisualizerPreset.All;//.Select(p => p.Name).ToList();

    private void HandleChange(VisualizerPreset value) => _vis.ApplyPreset(value);
    private void OnPresetApplied(VisualizerPreset obj) => _preset = obj;

}
